TreeCompare=function(){function e(e){var e=e?e:{};return n(e),this}function t(){for(var e=0;e<J.length;e++){var t=J[e].data;$("#"+t.canvasId+" svg").width($("#"+t.canvasId).width()),$("#"+t.canvasId+" svg").height($("#"+t.canvasId).height())}}function n(e){if(ht.useLengths=void 0!==e.useLengths?e.useLengths:ht.useLengths,ht.fontSize=void 0!==e.fontSize?e.fontSize:ht.fontSize,ht.lineThickness=void 0!==e.lineThickness?e.lineThickness:ht.lineThickness,ht.nodeSize=void 0!==e.nodeSize?e.nodeSize:ht.nodeSize,ht.treeWidth=void 0!==e.treeWidth?e.treeWidth:ht.treeWidth,ht.treeHeight=void 0!==e.treeHeight?e.treeHeight:ht.treeHeight,ht.moveOnClick=void 0!==e.moveOnClick?e.moveOnClick:ht.moveOnClick,ht.enableZoomSliders=void 0!==e.enableZoomSliders?e.enableZoomSliders:ht.enableZoomSliders,ht.scaleMin=void 0!==e.scaleMin?e.scaleMin:ht.scaleMin,ht.scaleMax=void 0!==e.scaleMax?e.scaleMax:ht.scaleMax,ht.scaleColor=void 0!==e.scaleColor?e.scaleColor:ht.scaleColor,ht.loadingCallback=void 0!==e.loadingCallback?e.loadingCallback:ht.loadingCallback,ht.loadedCallback=void 0!==e.loadedCallback?e.loadedCallback:ht.loadedCallback,ht.internalLabels=void 0!==e.internalLabels?e.internalLabels:ht.internalLabels,ht.enableDownloadButtons=void 0!==e.enableDownloadButtons?e.enableDownloadButtons:ht.enableDownloadButtons,ht.enableFisheyeZoom=void 0!==e.enableFisheyeZoom?e.enableFisheyeZoom:ht.enableFisheyeZoom,ht.zoomMode=void 0!==e.zoomMode?e.zoomMode:ht.zoomMode,ht.fitTree=void 0!==e.fitTree?e.fitTree:ht.fitTree,ht.enableSizeControls=void 0!==e.enableSizeControls?e.enableSizeControls:ht.enableSizeControls,ht.enableSearch=void 0!==e.enableSearch?e.enableSearch:ht.enableSearch,ht.autoCollapse=void 0!==e.autoCollapse?e.autoCollapse:ht.autoCollapse,void 0!==e.treeWidth)for(var t=0;t<X.length;t++)jQuery.extend(X[t].data,{treeWidth:e.treeWidth});if(void 0!==e.treeHeight)for(var t=0;t<X.length;t++)jQuery.extend(X[t].data,{treeHeight:e.treeHeight});r()}function r(){for(var e=0;e<J.length;e++)y(J[e].data.root,J[e].data)}function i(e){for(var t=[],n={},r=e.split(/\s*(;|\(|\)|,|:)\s*/),i=0;i<r.length;i++){var o=r[i];switch(o){case"(":var a={};n.children=[a],t.push(n),n=a;break;case",":var a={};t[t.length-1].children.push(a),n=a;break;case")":n=t.pop();break;case":":break;default:var l=r[i-1];")"==l||"("==l||","==l?n.name=o:":"==l&&(n.length=parseFloat(o))}}return n}function o(e,t){if(void 0===t){var n=X.length;t="Tree "+n}try{var r=i(e)}catch(o){throw"Invalid Newick"}for(var a=0;a<X.length;a++)if(t===X[a].name)throw"Tree With Name Already Exists";m(r,function(e){e.leaves=u(e),e.clickedParentHighlight=!1,e.mouseoverHighlight=!1,e.correspondingHighlight=!1});var s={root:r,name:t,data:{}};return s.data.autoCollapseDepth=l(r),X.push(s),s}function a(){return X}function l(e){var t=e.leaves.length;return 50>t?null:Math.floor(Math.log(t))+1}function s(e){X.splice(A(e),1);for(var t=0;t<J.length;t++)J[t].name===e&&($("#"+J[t].data.canvasId).empty(),J[t].data.scaleId&&$(J[t].data.scaleId).empty())}function c(e){for(var t=d3.scale.linear().domain(tt).range(et),n=200,r=100,i=30,o=i+25,a=d3.select("#"+e).append("svg").attr("width",n+"px").attr("height",o+"px").append("g"),l=0;r>l;l++)a.append("rect").attr("width",n/r+"px").attr("height",i+"px").attr("fill",t(l/r)).attr("x",n/r*l+"px");a.append("text").text("0").attr("x",0).attr("y",i+20).attr("fill",ht.scaleColor),a.append("text").text("1").attr("x",n-10).attr("y",i+20).attr("fill",ht.scaleColor)}function d(e){return e._children?e._children:e.children?e.children:[]}function h(e,t,n){if(n.children||n._children){for(var r=d(n),i=0,o=0,a=0;a<r.length&&(i=v(r[a]),o=r[a].y,0==i||0==o);a++);var l=(K/o*i/t).toFixed(2);e.text(l)}}function u(e){if(e.children||e._children){leaves=[];for(var t=d(e),n=0;n<t.length;n++)leaves=leaves.concat(u(t[n]));return leaves}return[e]}function g(e){for(var t=d(e),n=0;n<t.length;n++)t[n].parent=e,g(t[n])}function f(e){function t(e,n){if(e.children||e._children){for(var r=d(e),i=0;i<r.length;i++)n=Math.max(t(r[i],n),n);return n}return e.length?Math.max(e.length,n):n}var n=0;return t(e,n)}function p(e){function t(e,n){if(e.children){for(var r=e.children,i=0;i<r.length;i++)n=Math.max(t(r[i],n),n);return n}return e.length?Math.max(e.length,n):n}var n=0;return t(e,n)}function v(e){return e.parent?e.length+v(e.parent):0}function m(e,t,n){void 0===n&&(n=!0);var r=[];if(n)var r=d(e);else e.children&&(r=e.children);if(r.length>0){for(var i=0;i<r.length;i++)m(r[i],t,n);return void t(e)}return void t(e)}function y(e,t,n){function r(e){function t(e){if(e._children)n+=w/ot*e.leaves.length+2*L,r+=e.leaves.length;else if(e.children)for(var i=0;i<e.children.length;i++)t(e.children[i])}var n=0,r=0;return t(e),{collapsedHeight:n,leavesHidden:r}}function i(e,t){if(e.children){for(var n=t,o=0;o<e.children.length;o++){i(e.children[o],t);var a=0,l=0,s=r(e.children[o]),a=s.collapsedHeight,l=s.leavesHidden;t+=(e.children[o].leaves.length-l)*I+a}e.x=n+(t-n)/2}else if(e._children){var s=r(e),a=s.collapsedHeight;e.x=t+a/2}else e.x=t+I/2}function o(r){var i="bg"===r?"linkbg":"link",o=t.svg.selectAll("path."+i).data(d,function(e){return e.target.id}).style("stroke",function(e){if("front"===r){var t=e.target;if(t.searchHighlight)return"red";var e=e.source;return e[lt]&&!(e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight)?s(e[lt]):e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight?"green":at}return"bg"===r?"black":void 0});o.enter().insert("path","g").attr("class",function(){return"bg"===r?"linkbg":"link"}).attr("d",function(n){var n=n.source;return e===t.root&&n.parent?"M"+n.parent.y+","+n.parent.x+"L"+n.parent.y+","+n.parent.x+"L"+n.parent.y+","+n.parent.x:"M"+e.y+","+e.x+"L"+e.y+","+e.x+"L"+e.y+","+e.x}).style("fill","none").style("stroke-width",function(){return"bg"===r?parseInt(ht.lineThickness)+2:"front"===r?ht.lineThickness:void 0}).style("stroke",function(e){if("front"===r){var t=e.target;if(t.searchHighlight)return"red";var e=e.source;return e[lt]&&!(e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight)?s(e[lt]):e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight?"green":at}return"bg"===r?"black":void 0}),o.transition().duration(n).style("stroke-width",function(){return"bg"===r?parseInt(ht.lineThickness)+2:"front"===r?ht.lineThickness:void 0}).attr("d",function(e){return"M"+e.source.y+","+e.source.x+"L"+e.source.y+","+e.target.x+"L"+e.target.y+","+e.target.x}),o.exit().transition().duration(n).attr("d",function(n){var n=n.source;if(e===t.root){var r=B(n);return"M"+r.y+","+r.x+"L"+r.y+","+r.x+"L"+r.y+","+r.x}return"M"+e.y+","+e.x+"L"+e.y+","+e.x+"L"+e.y+","+e.x}).remove()}function a(e){function n(e){if(e.children)for(var t=0;t<e.children.length;t++)n(e.children[t]);ht.enableFisheyeZoom||(e.mouseoverHighlight=!0)}n(e),ht.enableFisheyeZoom||y(e,t)}function l(e){function n(e){if(e.children)for(var t=0;t<e.children.length;t++)n(e.children[t]);ht.enableFisheyeZoom||(e.mouseoverHighlight=!1)}n(e),ht.enableFisheyeZoom||y(e,t)}void 0===n&&(n=750);var s=d3.scale.linear().domain(tt).range(et),c=t.tree.nodes(t.root).reverse(),d=t.tree.links(c),u=t.root.leaves.length,g=C(t.root),f=($("#"+t.canvasId).width(),$("#"+t.canvasId).height()),x=f-2*rt,b=0,k=0;if(m(t.root,function(e){e._children&&(b+=e.leaves.length,k+=1)},!1),"scale"===ht.fitTree&&t.prevNoLeavesVisible){var z=1;g>0&&(z=x/(g+b),t.treeHeight=z)}"scale"!==ht.fitTree||0!==g||t.prevNoLeavesVisible||(z=x/(g+b),z*=ot,z-=z/ot/2,t.treeHeight=z),t.prevNoLeavesVisible=g>0?!1:!0;var w=t.treeHeight,f=u*w,L=w,S=r(t.root),T=S.collapsedHeight,b=S.leavesHidden,M=t.root.leaves.length-b>0?t.root.leaves.length-b:1,I=(t.root.leaves.length*w-T)/M,W=p(t.root),E=t.treeWidth;c.forEach(function(e){ht.useLengths?(e.y=v(e)*(E/W),e.baseY=e.y):(e.y=e.depth*E/10,e.baseY=e.y),e.y=e.y+nt}),i(t.root,0);var F=t.svg.selectAll("g.node").data(c,function(e){return e.id||(e.id=++t.i)}),Z=F.enter().append("g").attr("class","node").attr("transform",function(n){return e===t.root&&n.parent?"translate("+n.parent.y+","+n.parent.x+")":"translate("+e.y0+","+e.x0+")"}).style("cursor","pointer").on("mouseover",a).on("mouseout",l).on("click",t.clickEvent);Z.append("circle").attr("r",ht.nodeSize).style("fill",function(e){return e.bcnhighlight?e.bcnhighlight:e[lt]&&e.highlight<1?s(e[lt]):e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight?"green":e._children?"orange":"black"}),Z.append("rect").attr("y","-5px").attr("x","-5px").attr("width","0px").attr("height","0px").style("fill","magenta").style("stroke-width","2px").style("stroke","black"),Z.append("text").attr("x",function(e){return e.children||e._children?-13:13}).attr("dy",".35em").attr("text-anchor",function(e){return e.children||e._children?"end":"start"}).style("fill-opacity",1e-6).attr("font-size",function(){return ht.fontSize+"px"}).style("font-family","sans-serif"),Z.append("text").classed("triangleText",!0).attr("dy",".35em").style("fill-opacity",1e-6).attr("font-size",function(){return ht.fontSize+"px"}).style("font-family","sans-serif"),Z.append("path").attr("d",function(){return"M0,0L0,0L0,0L0,0"}),F.select("text").style("font-weight",function(e){return e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight?"bold":"normal"}).style("fill",function(e){return e.searchHighlight?"red":e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight?"green":"black"}).attr("font-size",function(){return ht.fontSize+"px"}),F.select("circle").attr("r",function(e){return e.bcnhighlight?1.5*ht.nodeSize:ht.nodeSize}).style("fill",function(e){return e.bcnhighlight?e.bcnhighlight:e.searchHighlight?"red":e[lt]&&!(e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight)?s(e[lt]):e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight?"green":e._children?"orange":"black"}).style("stroke","black").style("stroke-width",1),F.select("rect").attr("width",function(e){return e.clickedHighlight?2*ht.nodeSize+"px":"0px"}).attr("height",function(e){return e.clickedHighlight?2*ht.nodeSize+"px":"0px"}).style("fill",function(e){return e.clickedHighlight?e.clickedHighlight:void 0}).attr("y",-ht.nodeSize+"px").attr("x",-ht.nodeSize+"px");var P=F.transition().duration(n).attr("transform",function(e){return"translate("+e.y+","+e.x+")"});P.select("text").style("fill-opacity",1).text(function(e){if(!e.children&&!e._children)return e.name;if("none"===ht.internalLabels)return"";if("name"===ht.internalLabels)return e.name;if("length"===ht.internalLabels){if(e.length)return e.length.toFixed(3)}else if("similarity"===ht.internalLabels&&e[lt])return e[lt].toFixed(3)});var A=F.exit().transition().duration(n).attr("transform",function(n){if(e===t.root){var r=B(n);return"translate("+r.y+","+r.x+")"}return"translate("+e.y+","+e.x+")"}).remove();A.select("circle").attr("r",1e-6).attr("stroke","none"),A.select("text").style("fill-opacity",1e-6),A.select("path").attr("d",function(){return"M0,0L0,0L0,0L0,0"}),A.select(".triangleText").attr("x",0).style("fill-opacity",1e-6).each("end",function(){d3.select(this).text("")}),F.each(function(e){if(e._children){var t=0;_.each(e.leaves,function(e){t+=v(e)*(E/W)});var r=t/e.leaves.length,i=w/ot*e.leaves.length/2;d3.select(this).select("path").transition().duration(n).attr("d",function(e){return"M0,0L"+(r-v(e)*(E/W))+","+-i+"L"+(r-v(e)*(E/W))+","+i+"L0,0"}).style("fill",function(e){return e[lt]?s(e[lt]):"black"}),d3.select(this).select(".triangleText").attr("font-size",function(){return ht.fontSize+"px"}),d3.select(this).select(".triangleText").transition().duration(n).style("fill-opacity",1).text(function(e){var t=e.leaves[0].name+" ... "+e.leaves[e.leaves.length-1].name;return t}).style("fill",function(e){for(var t=!0,n=!0,r=0;r<e.leaves.length;r++)e.leaves[r].correspondingHighlight?n=!1:t=!1;return t?(d3.select(this).style("font-weight","bold"),"green"):t||n?(d3.select(this).style("font-weight","normal"),"black"):(d3.select(this).style("font-weight","bold"),"#99CC00")}).attr("x",function(e){var t=r-v(e)*(E/W)+5;return t})}e.children&&(d3.select(this).select("path").transition().duration(n).attr("d",function(){return"M0,0L0,0L0,0L0,0"}),d3.select(this).select(".triangleText").transition().duration(n).attr("x",0).style("fill-opacity",1e-6).each("end",function(){d3.select(this).text("")}))}),t.root[lt]&&o("bg"),o("front"),c.forEach(function(e){e.x0=e.x,e.y0=e.y}),ht.enableDownloadButtons&&setTimeout(function(){H(t.canvasId)},n),h(t.scaleText,t.zoomBehaviour.scale(),t.root)}function b(e){$("#zoomSlider"+e.id).on("input change",function(){e.zoomBehaviour.scale($("#zoomSlider"+e.id).val()),e.zoomBehaviour.event(e.svg)})}function k(e,t){t?(e.treeWidth=parseInt(e.treeWidth)+40,e.treeWidth=e.treeWidth>5?e.treeWidth:5):(e.treeWidth=parseInt(e.treeWidth)-40,e.treeWidth=e.treeWidth>5?e.treeWidth:5)}function z(e,t){t?(e.treeHeight=parseInt(e.treeHeight)+1,e.treeHeight=e.treeHeight>1?e.treeHeight:1):(e.treeHeight=parseInt(e.treeHeight)-1,e.treeHeight=e.treeHeight>1?e.treeHeight:1)}function H(e){$("#downloadButtons"+e).empty();var t=d3.select("#"+e+" svg").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().outerHTML;d3.select("#downloadButtons"+e).append("a").attr("title","file.svg").attr("href-lang","image/svg+xml").attr("href","data:image/svg+xml;base64,\n"+btoa(t)).text("Download As SVG").attr("download","PhyloIO_Tree"),$("#downloadButtons"+e+" a").css({color:"#999"})}function w(e,t){for(var n=!0,r=0;r<e.length;r++)e[r]&&t[r]&&(n=n&&e[r]===t[r]);return n}function B(e){return e.parent?e._children&&e.parent.children?e:B(e.parent):e}function L(e,t,n,r){function i(){z(x.data,!1),y(x.root,x.data,0)}function o(){z(x.data,!0),y(x.root,x.data,0)}function a(){k(x.data,!1),y(x.root,x.data,0)}function l(){k(x.data,!0),y(x.root,x.data,0)}function s(){D=!1,$("#resultsList"+t).empty(),$("#resultsBox"+t).slideUp(300,function(){$("#resultsBox"+t).css({display:"none"})}),$("#searchInput"+t).animate({width:"0px"},600,function(){$("#searchInput"+t).css({display:"none"}),$("#searchInput"+t).val("")})}function c(){var e=d3.event.scale,n=x.data.prevSemanticScale;if(n>e)z(x.data,!0),k(x.data,!0),y(x.root,x.data,0),x.data.prevSemanticScale=e,Q.translate(x.data.prevTransform?x.data.prevTransform:[0,0]);else if(e>n)z(x.data,!1),k(x.data,!1),y(x.root,x.data,0),Q.translate(x.data.prevTransform?x.data.prevTransform:[0,0]);else if(n==e){var r=100,i=$("#"+t+" svg").width(),o=$("#"+t+" svg").height(),a=d3.select("#"+t+" svg g").node().getBBox().height,l=d3.select("#"+t+" svg g").node().getBBox().width,s=d3.event.translate,c=-(a-o)-r*e,d=r,u=-(l-i)-r*e,g=r;h(U,e,V),o-2*r>a&&(d=c-r,c=r),i-2*r>l&&(g=u-r,u=r),s=[Math.max(Math.min(s[0],g),u),Math.max(Math.min(s[1],d),c)],Q.translate(s),x.data.prevTransform=s,d3.select("#"+t+" svg g").attr("transform","translate("+s+")")}x.data.prevSemanticScale=e}function d(){var e=100,n=$("#"+t+" svg").width(),r=$("#"+t+" svg").height(),i=d3.event.scale,o=d3.select("#"+t+" svg g").node().getBBox().height*i,a=d3.select("#"+t+" svg g").node().getBBox().width*i,l=d3.event.translate,s=-(o-r)-e*i,c=e,d=-(a-n)-e*i,u=e;h(U,i,V),r-2*e>o&&(c=s-e,s=e),n-2*e>a&&(u=d-e,d=e),l=[Math.max(Math.min(l[0],u),d),Math.max(Math.min(l[1],c),s)],j.translate(l),j.scale(i),ht.enableZoomSliders&&$("#zoomSlider"+x.data.id).val(i),d3.select("#"+t+" svg g").attr("transform","translate("+l+") scale("+i+")"),H(t)}var x=X[A(e)];if(void 0!==r)var B=X[A(e)];if(J.push(x),$("#"+t).empty(),$("#"+n).empty(),n="#"+n,ht.enableZoomSliders&&($("#"+t).append('<div class="zoomSliderContainer">Zoom: <input type="range" class="zoomSlider" id="zoomSlider'+A(e)+'" min="0.05" max="5" value="1.00" step="0.01"></input></div>'),$(".zoomSliderContainer").css({position:"absolute",color:"black","margin-left":"5px","margin-top":"5px"})),ht.enableSizeControls){{ht.enableZoomSliders?"50px":"10px"}$("#"+t).append('<div id="zoomButtons"></div>'),$("#"+t+" #zoomButtons").append('<button type="button" id="upButton" class="btn btn-primary zoomButton"><span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span></button>'),$("#"+t+" #zoomButtons").append('<button type="button" id="leftButton" class="btn btn-primary zoomButton"><span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span></button>'),$("#"+t+" #zoomButtons").append('<button type="button" id="rightButton" class="btn btn-primary zoomButton"><span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span></button>'),$("#"+t+" #zoomButtons").append('<button type="button" id="downButton" class="btn btn-primary zoomButton"><span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span></button>'),$("#"+t+" #zoomButtons").css({width:"78px",top:"50px",left:"10px",position:"absolute"}),$("#"+t+" .zoomButton").css({"font-size":"10px",width:"26px",height:"26px","vertical-align":"top",opacity:"0.3"}),$("#"+t+" .zoomButton span").css({"vertical-align":"middle"}),$("#"+t+" #upButton").css({display:"block","margin-left":"26px"}),$("#"+t+" #leftButton").css({"float":"left"}),$("#"+t+" #rightButton").css({"margin-left":"26px","float":"right"}),$("#"+t+" #downButton").css({display:"block","margin-left":"26px"}),$("#"+t+" .zoomButton").on("mouseover",function(){$(this).css({opacity:"1"})}),$("#"+t+" .zoomButton").on("mouseout",function(){$(this).css({opacity:"0.3"})});var L=0;$("#"+t+" #upButton").mousedown(function(){i(),L=setInterval(i,50)}).bind("mouseup mouseleave",function(){clearTimeout(L)});var S=0;$("#"+t+" #downButton").mousedown(function(){o(),S=setInterval(o,50)}).bind("mouseup mouseleave",function(){clearTimeout(S)});var M=0;$("#"+t+" #leftButton").mousedown(function(){a(),M=setInterval(a,150)}).bind("mouseup mouseleave",function(){clearTimeout(M)});var W=0;$("#"+t+" #rightButton").mousedown(function(){l(),W=setInterval(l,150)}).bind("mouseup mouseleave",function(){clearTimeout(W)})}var E=0,F=$("#"+t).width(),Z=$("#"+t).height(),P=d3.layout.tree().size([Z,F]),N=(d3.svg.diagonal().projection(function(e){return[e.y,e.x]}),d3.select("#"+t).append("svg").attr("width",F).attr("height",Z).append("g"));if(ht.enableDownloadButtons&&($("#"+t).append('<div id="downloadButtons'+t+'"></div>'),$("#downloadButtons"+t).css({"margin-left":"2px",bottom:"5px",position:"absolute"})),ht.enableSearch){$("#"+t).append('<div id="searchBox'+t+'"><a class="btn btn-default" id="searchButton'+t+'"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></a><input type="text" placeholder="search" id="searchInput'+t+'" autofocus></input></div>'),$("#searchBox"+t).append('<div id="resultsBox'+t+'"><ul id="resultsList'+t+'"></ul></div>'),$("#searchBox"+t).css({"max-width":"250px","min-height":"45px",padding:"5px",right:"5px",top:"5px",position:"absolute","background-color":"gray","-webkit-border-radius":"5px","-moz-border-radius":"5px","border-radius":"5px"}),$("#searchInput"+t).css({"float":"right",width:"0px","margin-left":"0px","margin-top":"5px",display:"none"}),$("#searchButton"+t).css({width:"50px","float":"right"}),$("#resultsBox"+t).css({width:"200px",position:"absolute","margin-right":"10px","max-height":"200px",overflow:"scroll","margin-top":"40px","background-color":"#efefef","-webkit-box-shadow":"0px 0px 2px 1px rgba(0,0,0,0.75)","-moz-box-shadow":"0px 0px 2px 1px rgba(0,0,0,0.75)","box-shadow":"0px 0px 2px 1px rgba(0,0,0,0.75)",display:"none","padding-top":"10px"});var D=!1;$("#searchButton"+t).click(function(){D?s():(D=!0,$("#searchInput"+t).css({display:"inline"}),$("#searchInput"+t).animate({width:"150px"},600,function(){$("#searchInput"+t).focus()}))});for(var O=[],E=0;E<x.root.leaves.length;E++)O.push(x.root.leaves[E]);$("#"+t+" svg").click(function(){s()}),$("#searchInput"+t).bind("paste keyup",function(){$("#resultsList"+t).empty();var e=$(this).val(),n=_.filter(O,function(t){return w(t.name.toLowerCase(),e.toLowerCase())});if(""!==e){$("#resultsBox"+t).slideDown(200),$("#resultsList"+t).empty();for(var i=0;i<n.length;i++)$("#resultsList"+t).append('<li class="'+i+'"><a href="#">'+n[i].name+"</a></li>"),$("#resultsList"+t+" li").css({"margin-left":"-25px","list-style-type":"none",cursor:"pointer",cursor:"hand"}),$("#resultsList"+t+" ."+i).on("click",function(){var e=$(this).attr("class");T(n[e]),void 0!==r?(ht.loadingCallback(),setTimeout(function(){I(x.root,B.root,!1),ht.loadedCallback(),y(x.root,x.data)},2)):y(x.root,x.data)})}else $("#resultsList"+t).empty(),$("#resultsBox"+t).slideUp(200,function(){$("#resultsBox"+t).css({display:"none"})})})}var j=d3.behavior.zoom().scaleExtent([ht.scaleMin,ht.scaleMax]).on("zoom",d),Q=d3.behavior.zoom().on("zoom",c);$(".zoomSlider").attr("min",ht.scaleMin),$(".zoomSlider").attr("max",ht.scaleMax),"traditional"===ht.zoomMode?d3.select("#"+t+" svg").call(j):"semantic"===ht.zoomMode&&d3.select("#"+t+" svg").call(Q);var V=x.root;if(V.x0=Z/2,V.y0=0,n){{d3.select(n).append("svg").attr("width",$(n).width()).attr("height",$(n).height()).append("g")}d3.select(n+" svg").append("path").attr("d",function(){var e=parseFloat(d3.select(n+" svg").style("width"));return K=.75*e,"M"+R+",20L"+(K+R)+",20"}).attr("stroke-width",1).attr("stroke",ht.scaleColor);var U=d3.select(n+" svg").append("text").attr("x",K/2+R).attr("y",35).attr("font-family","sans-serif").text("0").attr("font-size","14px").attr("fill",ht.scaleColor).attr("text-anchor","middle");jQuery.extend(x.data,{scaleText:U})}if(jQuery.extend(x.data,{canvasId:t,root:V,tree:P,svg:N,i:E,id:A(e),zoomBehaviour:j,zoomBehaviourSemantic:Q,scaleId:n}),m(x.data.root,function(e){e.leaves=u(e),e.clickedParentHighlight=!1,e.correspondingHighlight=!1,e.mouseoverHighlight=!1}),b(x.data),jQuery.extend(x.data,{treeWidth:ht.treeWidth,treeHeight:ht.treeHeight}),"scale"===ht.fitTree){var q=Z-2*rt,G=C(x.root),et=0,tt=0;m(x.root,function(e){e._children&&(et+=e.leaves.length,tt+=1)},!1);var nt=1;G>0?nt=q/(G+et):(nt=q/(G+et),nt*=ot,nt-=nt/ot/2,x.data.prevNoLeavesVisible=!0);var at=0;g(x.data.root),m(x.data.root,function(e){var t=v(e);t>at&&(at=t)});var lt=p(x.data.root),st=F/at*lt-2*it;0>st&&(st=F/at*lt),x.data.treeWidth=st,x.data.treeHeight=nt}y(x.root,x.data),x.data.zoomBehaviour.translate([100,100]),x.data.zoomBehaviour.scale(.8),d3.select("#"+x.data.canvasId+" svg g").attr("transform","translate("+[100,100]+") scale(0.8)"),Y(),d3.select("#"+t).on("mousemove",function(){if(ht.enableFisheyeZoom){var e=N.selectAll("path.link"),t=N.selectAll("path.linkbg"),n=N.selectAll("g.node"),r=j.scale(),i=d3.fisheye.circular().radius(600/(3*r)).distortion(2/(r/.9)),o=[(d3.mouse(this)[1]-j.translate()[1])/r,(d3.mouse(this)[0]-j.translate()[0])/r];i.focus(o),n.each(function(e){e.fisheye=i(e)}),n.select("circle").attr("r",function(e){return e.fisheye.z*ht.nodeSize}).attr("cy",function(e){return e.fisheye.x-e.x}),n.select("path").attr("d",function(e){if(e._children){var t=f(x.root),n=x.data.treeWidth,r=0,i=x.data.treeHeight;_.each(e.leaves,function(e){r+=v(e)*(n/t)});var o=r/e.leaves.length,a=i/ot*e.leaves.length/2;return"M0,"+(e.fisheye.x-e.x)+"L"+(o-v(e)*(n/t))+","+(-a-e.x+e.fisheye.x)+"L"+(o-v(e)*(n/t))+","+(a-e.x+e.fisheye.x)+"L0,"+(e.fisheye.x-e.x)}}),n.select(".triangleText").attr("y",function(e){return e.fisheye.x-e.x}).attr("font-size",function(e){if(d3.select(this).attr("font-size")){var t=e.fisheye.z/2>1?e.fisheye.z/2:1;return ht.fontSize*t}}),n.select("rect").attr("width",function(e){return e.clickedHighlight?e.fisheye.z*ht.nodeSize*2:void 0}).attr("height",function(e){return e.clickedHighlight?e.fisheye.z*ht.nodeSize*2:void 0}).attr("y",function(e){return e.fisheye.x-e.x-e.fisheye.z*ht.nodeSize}),n.select("text").attr("font-size",function(e){if(d3.select(this).attr("font-size")){var t=e.fisheye.z/2>1?e.fisheye.z/2:1;return ht.fontSize*t}}).attr("y",function(e){return e.fisheye.x-e.x}),e.attr("d",function(e){return"M"+e.source.y+","+e.source.fisheye.x+"L"+e.source.y+","+e.target.fisheye.x+"L"+e.target.y+","+e.target.fisheye.x}),t.attr("d",function(e){return"M"+e.source.y+","+e.source.fisheye.x+"L"+e.source.y+","+e.target.fisheye.x+"L"+e.target.y+","+e.target.fisheye.x})}}),d3.select(self.frameElement).style("height","500px")}function C(e){var t=0;return m(e,function(e){var n=d(e);0===n.length&&(t+=1)},!1),t}function S(e){ht.autoCollapse=e;for(var t=0;t<J.length;t++)null===e?j(J[t].root):O(J[t].root,e);2===J.length?(ht.loadingCallback(),setTimeout(function(){I(J[0].root,J[1].root,!1),y(J[0].root,J[0].data),y(J[1].root,J[1].data),ht.loadedCallback()},2)):y(J[0].root,J[0].data)}function T(e,t){void 0===t&&(t=!1),e.parent&&(t?e.searchHighlight=!1:(e.parent._children&&(e.parent.children=e.parent._children,e.parent._children=null),e.searchHighlight=!0),T(e.parent,t))}function M(e){e.parent&&(e.parent._children&&(e.parent.children=e.parent._children,e.parent._children=null),M(e.parent))}function I(e,t,n){function r(e,t){var i=e.children?e.children:[];if(i.length>0){for(var o=0;o<i.length;o++)r(i[o],t);return void((n||!e.elementBCN)&&G(e,t))}return void((n||!e.elementBCN)&&G(e,t))}void 0===n&&(n=!0),r(e,t),r(t,e)}function W(e,t){for(var n=X[e].root,r=X[t].root,i=0;i<n.leaves.length;i++)for(var o=0;o<r.leaves.length;o++)n.leaves[i].name===r.leaves[o].name&&(n.leaves[i].correspondingLeaf=r.leaves[o],r.leaves[o].correspondingLeaf=n.leaves[i]);m(n,function(e){e.deepLeafList=Z(e)}),m(r,function(e){e.deepLeafList=Z(e)}),I(n,r)}function E(e,t){for(var n=[],r=0;r<e.leaves.length;r++)for(var i=0;i<t.length;i++)if(e.leaves[r].name===t[i].name){n.push(e);for(var o=d(e),a=0;a<o.length;a++)n=n.concat(E(o[a],t));return n}return n}function F(e){return e.name}function Z(e){function t(e){var i=d(e);{if(!(i.length>0))return void n.push(e.name);r>0&&n.push(_.sortBy(_.map(e.leaves,F),function(e){return e}).toString()),r+=1;for(var o=0;o<i.length;o++)t(i[o])}}var n=[],r=0;return t(e),n}function P(e,t){var n=e.deepLeafList,r=t.deepLeafList,i=n.length,o=r.length,a=_.intersection(n,r).length;return a/(i+o-a)}function A(e){for(var t=0;t<X.length;t++)if(e===X[t].name)return t}function N(e,t,n,r,i,o){J=[];var a=A(e),l=A(n);ht.loadingCallback(),setTimeout(function(){j(X[a].root),j(X[l].root),Q(X[a].root),Q(X[l].root),V(X[a].root),V(X[l].root),null!==ht.autoCollapse&&(O(X[a].root,ht.autoCollapse),O(X[l].root,ht.autoCollapse)),W(a,l),X[a].data.clickEvent=q(X[a],!0,X[l]),X[l].data.clickEvent=q(X[l],!0,X[a]),L(e,t,i,n),L(n,r,o,e),ht.loadedCallback()},2)}function D(e,t,n){J=[];var r=A(e);ht.loadingCallback(),setTimeout(function(){j(X[r].root),Q(X[r].root),V(X[r].root),null!==ht.autoCollapse&&O(X[r].root,ht.autoCollapse),X[r].data.clickEvent=q(X[r],!1,{}),L(e,t,n),ht.loadedCallback()},2)}function O(e,t){e.depth>t?e.children&&(e._children=e.children,e.children=null):e._children&&(e.children=e._children,e._children=null);for(var n=d(e),r=0;r<n.length;r++)O(n[r],t)}function j(e){m(e,function(e){e._children&&(e.children=e._children,e._children=null)})}function Q(e){m(e,function(e){e.bcnhighlight=null,e.elementBCN=null,e.elementS=null,e.x=null,e.y=null,e.x0=null,e.y0=null,e.source=null,e.target=null,e.baseX=null,e.baseY=null,e.id=null})}function V(e,t){void 0===t&&(t=0),e.depth=t;var n=d(e);t+=1;for(var r=0;r<n.length;r++)V(n[r],t)}function Y(){return function(){function e(t,n,r){function i(e){var i=t(e),o=r>i,a=d3.extent(t.range()),l=a[0],s=a[1],c=o?r-l:s-r;return 0==c&&(c=s-l),(o?-1:1)*c*(n+1)/(n+c/Math.abs(i-r))+r}return i.distortion=function(e){return arguments.length?(n=+e,i):n},i.focus=function(e){return arguments.length?(r=+e,i):r},i.copy=function(){return e(t.copy(),n,r)},i.nice=t.nice,i.ticks=t.ticks,i.tickFormat=t.tickFormat,d3.rebind(i,t,"domain","range")}d3.fisheye={scale:function(t){return e(t(),3,0)},circular:function(){function e(e){var t=e.x-a[0],o=e.y-a[1],l=Math.sqrt(t*t+o*o);if(!l||l>=i)return{x:e.x,y:e.y,z:l>=i?1:10};var s=n*(1-Math.exp(-l*r))/l*.75+.25;return{x:a[0]+t*s,y:a[1]+o*s,z:Math.min(s,10)}}function t(){return n=Math.exp(o),n=n/(n-1)*i,r=o/i,e}var n,r,i=200,o=2,a=[0,0];return e.radius=function(e){return arguments.length?(i=+e,t()):i},e.distortion=function(e){return arguments.length?(o=+e,t()):o},e.focus=function(t){return arguments.length?(a=t,e):a},t()}}}()}function U(e){e.selectAll(".tooltipElem").remove()}function q(e,t,n){function r(r){function i(r){var i=!1;t&&r._children&&(i=!0,ht.loadingCallback()),setTimeout(function(){r.children?(r._children=r.children,r.children=null):(r.children=r._children,r._children=null,t&&m(r,function(e){G(e,n.root)},!1)),i&&ht.loadedCallback(),y(r,e.data)},2)}function o(r){var i=!1;t&&r._children&&(i=!0,ht.loadingCallback()),setTimeout(function(){r._children?m(r,function(e){e._children&&(e.children=e._children,e._children=null),t&&G(e,n.root)}):r.children&&m(r,function(e){e.children&&(e._children=e.children,e.children=null)}),i&&ht.loadedCallback(),y(r,e.data)},2)}function a(r){function i(e,t){if(e.children)for(var n=0;n<e.children.length;n++)i(e.children[n],t);e.clickedParentHighlight=t?!0:!1}var o=d3.scale.category20();if(t)if(_.contains(ct,r)){r.clickedHighlight=!1;var a=ct.indexOf(r);a>-1&&ct.splice(a,1),r[st].bcnhighlight=!1;for(var l=(r[st]?r[st].id:-1,r.leaves),s=n.root,c=n.data,d=(c.leaves,0);d<l.length;d++)l[d].correspondingLeaf.correspondingHighlight=!1;i(r,!1),y(r,e.data),y(c.root,c)}else if(ct.length<dt){r.clickedHighlight=o(ct.length),r[st].bcnhighlight=o(ct.length),ct.push(r);for(var l=r.leaves,s=n.root,c=n.data,d=(c.leaves,0);d<l.length;d++)l[d].correspondingLeaf.correspondingHighlight=!0;M(r[st]),ht.loadingCallback(),setTimeout(function(){if(I(s,e.root,!1),ht.loadedCallback(),i(r,!0),y(r,e.data),y(c.root,c),ht.moveOnClick){var t=c.zoomBehaviour.scale(),n=-r[st].y+$("#"+c.canvasId).width()/2/t,o=-r[st].x+$("#"+c.canvasId).height()/2/t;c.zoomBehaviour.translate([n,o]),d3.select("#"+c.canvasId+" svg g").transition(1500).attr("transform","scale("+t+")translate("+c.zoomBehaviour.translate()+")")}},2)}}var l=e.data.svg;if(r.tooltipActive)return r.tooltipActive=!1,m(r,function(e){e.mouseoverHighlight=!1}),y(r,e.data),void U(l);r.tooltipActive=!0,r.children||r._children||r.searchHighlight!==!0||(T(r,!0),y(e.root,e.data));var s=10,c=15,d=150,h=90;d3.select(this).append("path").attr("class","tooltipElem").attr("d",function(){return"M0,0L"+-s+","+-c+"L"+s+","+-c}).style("fill","gray"),d3.select(this).append("rect").attr("class","tooltipElem").attr("x",function(){return-(d/2)}).attr("y",function(){return-c-h+1}).attr("width",d).attr("height",h).attr("rx",10).attr("ry",10).style("fill","gray");var u=10,g=20,f=0,p=20;d3.select(this).append("text").attr("class","tooltipElem tooltipElemText").attr("y",-h-c+g+f).attr("x",-d/2+u).style("fill","white").style("font-weight","bold").text(function(e){return e._children?(f+=p,"uncollapse >"):e.children?(f+=p,"collapse >"):void 0}).on("click",function(e){m(e,function(e){e.mouseoverHighlight=!1}),i(e),U(l)}),d3.select(this).append("text").attr("class","tooltipElem tooltipElemText").attr("y",-h-c+g+f).attr("x",-d/2+u).style("fill","white").style("font-weight","bold").text(function(e){return e._children?(f+=p,"uncollapse all >"):e.children?(f+=p,"collapse all >"):void 0}).on("click",function(e){m(e,function(e){e.mouseoverHighlight=!1}),o(e),U(l)}),d3.select(this).append("text").attr("class","tooltipElem tooltipElemText").attr("y",-h-c+g+f).attr("x",-d/2+u).style("fill","white").style("font-weight","bold").text(function(e){return e.elementBCN?(f+=p,e.clickedParentHighlight?"unhighlight >":"highlight >"):void 0}).on("click",function(e){m(e,function(e){e.mouseoverHighlight=!1}),a(e),U(l)}),d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.select(this).moveToFront(),d3.select(this).selectAll(".tooltipElemText").each(function(){d3.select(this).on("mouseover",function(){d3.select(this).transition().duration(50).style("fill","black")}),d3.select(this).on("mouseout",function(){d3.select(this).transition().duration(50).style("fill","white")})})}return r}function G(e,t){for(var n=null,r=0,i=e.leaves,o=E(t,i),a=0;a<o.length;a++)x=P(e,o[a]),x>r&&(r=x,n=o[a]);e.elementBCN=n,e.elementS=r
}var X=[],J=[],K=0,R=10,et=["rgb(254,240,217)","rgb(253,212,158)","rgb(253,187,132)","rgb(252,141,89)","rgb(227,74,51)","rgb(179,0,0)"],tt=[1,.8,.6,.4,.2,0],nt=20,rt=50,it=100,ot=3,at="black",lt="elementS",st="elementBCN",ct=[],dt=20,ht={useLengths:!0,fontSize:14,lineThickness:3,nodeSize:3,treeWidth:500,treeHeight:15,moveOnClick:!0,enableZoomSliders:!0,scaleMin:.05,scaleMax:5,scaleColor:"black",loadingCallback:function(){},loadedCallback:function(){},internalLabels:"none",enableDownloadButtons:!0,enableFisheyeZoom:!1,zoomMode:"traditional",fitTree:"scale",enableSizeControls:!0,enableSearch:!0,autoCollapse:null};return window.onresize=t,{init:e,viewTree:D,renderColorScale:c,addTree:o,removeTree:s,getTrees:a,compareTrees:N,changeSettings:n,changeAutoCollapseDepth:S}}();