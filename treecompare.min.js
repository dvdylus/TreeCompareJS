TreeCompare=function(){function e(e){var e=e?e:{};return n(e),this}function t(){for(var e=0;e<G.length;e++){var t=G[e].data;$("#"+t.canvasId+" svg").width($("#"+t.canvasId).width()),$("#"+t.canvasId+" svg").height($("#"+t.canvasId).height())}}function n(e){if(lt.useLengths=void 0!==e.useLengths?e.useLengths:lt.useLengths,lt.fontSize=void 0!==e.fontSize?e.fontSize:lt.fontSize,lt.lineThickness=void 0!==e.lineThickness?e.lineThickness:lt.lineThickness,lt.nodeSize=void 0!==e.nodeSize?e.nodeSize:lt.nodeSize,lt.treeWidth=void 0!==e.treeWidth?e.treeWidth:lt.treeWidth,lt.treeHeight=void 0!==e.treeHeight?e.treeHeight:lt.treeHeight,lt.moveOnClick=void 0!==e.moveOnClick?e.moveOnClick:lt.moveOnClick,lt.enableZoomSliders=void 0!==e.enableZoomSliders?e.enableZoomSliders:lt.enableZoomSliders,lt.scaleMin=void 0!==e.scaleMin?e.scaleMin:lt.scaleMin,lt.scaleMax=void 0!==e.scaleMax?e.scaleMax:lt.scaleMax,lt.scaleColor=void 0!==e.scaleColor?e.scaleColor:lt.scaleColor,lt.loadingCallback=void 0!==e.loadingCallback?e.loadingCallback:lt.loadingCallback,lt.loadedCallback=void 0!==e.loadedCallback?e.loadedCallback:lt.loadedCallback,lt.internalLabels=void 0!==e.internalLabels?e.internalLabels:lt.internalLabels,lt.enableDownloadButtons=void 0!==e.enableDownloadButtons?e.enableDownloadButtons:lt.enableDownloadButtons,lt.enableFisheyeZoom=void 0!==e.enableFisheyeZoom?e.enableFisheyeZoom:lt.enableFisheyeZoom,lt.zoomMode=void 0!==e.zoomMode?e.zoomMode:lt.zoomMode,lt.fitTree=void 0!==e.fitTree?e.fitTree:lt.fitTree,lt.enableSizeControls=void 0!==e.enableSizeControls?e.enableSizeControls:lt.enableSizeControls,lt.enableSearch=void 0!==e.enableSearch?e.enableSearch:lt.enableSearch,lt.autoCollapse=void 0!==e.autoCollapse?e.autoCollapse:lt.autoCollapse,void 0!==e.treeWidth)for(var t=0;t<q.length;t++)jQuery.extend(q[t].data,{treeWidth:e.treeWidth});if(void 0!==e.treeHeight)for(var t=0;t<q.length;t++)jQuery.extend(q[t].data,{treeHeight:e.treeHeight});r()}function r(){for(var e=0;e<G.length;e++)v(G[e].data.root,G[e].data)}function i(e){for(var t=[],n={},r=e.split(/\s*(;|\(|\)|,|:)\s*/),i=0;i<r.length;i++){var a=r[i];switch(a){case"(":var o={};n.children=[o],t.push(n),n=o;break;case",":var o={};t[t.length-1].children.push(o),n=o;break;case")":n=t.pop();break;case":":break;default:var l=r[i-1];")"==l||"("==l||","==l?n.name=a:":"==l&&(n.length=parseFloat(a))}}return n}function a(e,t){if(void 0===t){var n=q.length;t="Tree "+n}try{var r=i(e)}catch(a){throw"Invalid Newick"}for(var o=0;o<q.length;o++)if(t===q[o].name)throw"Tree With Name Already Exists";p(r,function(e){e.leaves=h(e),e.clickedParentHighlight=!1,e.mouseoverHighlight=!1,e.correspondingHighlight=!1});var l={root:r,name:t,data:{}};return q.push(l),l}function o(){return q}function l(e){q.splice(Z(e),1);for(var t=0;t<G.length;t++)G[t].name===e&&($("#"+G[t].data.canvasId).empty(),G[t].data.scaleId&&$(G[t].data.scaleId).empty())}function s(e){for(var t=d3.scale.linear().domain(R).range(K),n=200,r=100,i=30,a=i+25,o=d3.select("#"+e).append("svg").attr("width",n+"px").attr("height",a+"px").append("g"),l=0;r>l;l++)o.append("rect").attr("width",n/r+"px").attr("height",i+"px").attr("fill",t(l/r)).attr("x",n/r*l+"px");o.append("text").text("0").attr("x",0).attr("y",i+20).attr("fill",lt.scaleColor),o.append("text").text("1").attr("x",n-10).attr("y",i+20).attr("fill",lt.scaleColor)}function c(e){return e._children?e._children:e.children?e.children:[]}function d(e,t,n){if(n.children||n._children){for(var r=c(n),i=0,a=0,o=0;o<r.length&&(i=f(r[o]),a=r[o].y,0==i||0==a);o++);var l=(X/a*i/t).toFixed(2);e.text(l)}}function h(e){if(e.children||e._children){leaves=[];for(var t=c(e),n=0;n<t.length;n++)leaves=leaves.concat(h(t[n]));return leaves}return[e]}function u(e){for(var t=c(e),n=0;n<t.length;n++)t[n].parent=e,u(t[n])}function g(e){function t(e,n){if(e.children||e._children){for(var r=c(e),i=0;i<r.length;i++)n=Math.max(t(r[i],n),n);return n}return e.length?Math.max(e.length,n):n}var n=0;return t(e,n)}function f(e){return e.parent?e.length+f(e.parent):0}function p(e,t,n){void 0===n&&(n=!0);var r=[];if(n)var r=c(e);else e.children&&(r=e.children);if(r.length>0){for(var i=0;i<r.length;i++)p(r[i],t,n);return void t(e)}return void t(e)}function v(e,t,n){function r(e){function t(e){if(e._children)n+=B/tt*e.leaves.length+2*C,r+=e.leaves.length;else if(e.children)for(var i=0;i<e.children.length;i++)t(e.children[i])}var n=0,r=0;return t(e),{collapsedHeight:n,leavesHidden:r}}function i(e,t){if(e.children){for(var n=t,a=0;a<e.children.length;a++){i(e.children[a],t);var o=0,l=0,s=r(e.children[a]),o=s.collapsedHeight,l=s.leavesHidden;t+=(e.children[a].leaves.length-l)*I+o}e.x=n+(t-n)/2}else if(e._children){var s=r(e),o=s.collapsedHeight;e.x=t+o/2}else e.x=t+I/2;e.x=e.x+et}function a(r){var i="bg"===r?"linkbg":"link",a=t.svg.selectAll("path."+i).data(h,function(e){return e.target.id}).style("stroke",function(e){if("front"===r){var t=e.target;if(t.searchHighlight)return"red";var e=e.source;return e[rt]&&!(e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight)?s(e[rt]):e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight?"green":nt}return"bg"===r?"black":void 0});a.enter().insert("path","g").attr("class",function(){return"bg"===r?"linkbg":"link"}).attr("d",function(n){var n=n.source;return e===t.root&&n.parent?"M"+n.parent.y+","+n.parent.x+"L"+n.parent.y+","+n.parent.x+"L"+n.parent.y+","+n.parent.x:"M"+e.y+","+e.x+"L"+e.y+","+e.x+"L"+e.y+","+e.x}).style("fill","none").style("stroke-width",function(){return"bg"===r?parseInt(lt.lineThickness)+2:"front"===r?lt.lineThickness:void 0}).style("stroke",function(e){if("front"===r){var t=e.target;if(t.searchHighlight)return"red";var e=e.source;return e[rt]&&!(e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight)?s(e[rt]):e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight?"green":nt}return"bg"===r?"black":void 0}),a.transition().duration(n).style("stroke-width",function(){return"bg"===r?parseInt(lt.lineThickness)+2:"front"===r?lt.lineThickness:void 0}).attr("d",function(e){return"M"+e.source.y+","+e.source.x+"L"+e.source.y+","+e.target.x+"L"+e.target.y+","+e.target.x}),a.exit().transition().duration(n).attr("d",function(n){var n=n.source;if(e===t.root){var r=H(n);return"M"+r.y+","+r.x+"L"+r.y+","+r.x+"L"+r.y+","+r.x}return"M"+e.y+","+e.x+"L"+e.y+","+e.x+"L"+e.y+","+e.x}).remove()}function o(e){function n(e){if(e.children)for(var t=0;t<e.children.length;t++)n(e.children[t]);lt.enableFisheyeZoom||(e.mouseoverHighlight=!0)}n(e),lt.enableFisheyeZoom||v(e,t)}function l(e){function n(e){if(e.children)for(var t=0;t<e.children.length;t++)n(e.children[t]);lt.enableFisheyeZoom||(e.mouseoverHighlight=!1)}n(e),lt.enableFisheyeZoom||v(e,t)}void 0===n&&(n=750);var s=d3.scale.linear().domain(R).range(K),c=t.tree.nodes(t.root).reverse(),h=t.tree.links(c),u=t.root.leaves.length,m=L(t.root),x=($("#"+t.canvasId).width(),$("#"+t.canvasId).height()),y=x-2*et,b=0,z=0;if(p(t.root,function(e){e._children&&(b+=e.leaves.length,z+=1)},!1),"scale"===lt.fitTree&&t.prevNoLeavesVisible){var w=1;m>0&&(w=y/(m+b),t.treeHeight=w)}"scale"!==lt.fitTree||0!==m||t.prevNoLeavesVisible||(w=y/(m+b),w*=tt,w-=w/tt/2,t.treeHeight=w),t.prevNoLeavesVisible=m>0?!1:!0;var B=t.treeHeight,x=u*B,C=B,S=r(t.root),T=S.collapsedHeight,b=S.leavesHidden,M=t.root.leaves.length-b>0?t.root.leaves.length-b:1,I=(t.root.leaves.length*B-T)/M,W=g(t.root),E=t.treeWidth;c.forEach(function(e){lt.useLengths?(e.y=f(e)*(E/W),e.baseY=e.y):(e.y=e.depth*E/10,e.baseY=e.y),e.y=e.y+et}),i(t.root,0);var F=t.svg.selectAll("g.node").data(c,function(e){return e.id||(e.id=++t.i)}),Z=F.enter().append("g").attr("class","node").attr("transform",function(n){return e===t.root&&n.parent?"translate("+n.parent.y+","+n.parent.x+")":"translate("+e.y0+","+e.x0+")"}).style("cursor","pointer").on("mouseover",o).on("mouseout",l).on("click",t.clickEvent);Z.append("circle").attr("r",lt.nodeSize).style("fill",function(e){return e.bcnhighlight?e.bcnhighlight:e[rt]&&e.highlight<1?s(e[rt]):e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight?"green":e._children?"orange":"black"}),Z.append("rect").attr("y","-5px").attr("x","-5px").attr("width","0px").attr("height","0px").style("fill","magenta").style("stroke-width","2px").style("stroke","black"),Z.append("text").attr("x",function(e){return e.children||e._children?-13:13}).attr("dy",".35em").attr("text-anchor",function(e){return e.children||e._children?"end":"start"}).style("fill-opacity",1e-6).attr("font-size",function(){return lt.fontSize+"px"}).style("font-family","sans-serif"),Z.append("text").classed("triangleText",!0).attr("dy",".35em").style("fill-opacity",1e-6).attr("font-size",function(){return lt.fontSize+"px"}).style("font-family","sans-serif"),Z.append("path").attr("d",function(){return"M0,0L0,0L0,0L0,0"}),F.select("text").style("font-weight",function(e){return e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight?"bold":"normal"}).style("fill",function(e){return e.searchHighlight?"red":e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight?"green":"black"}).attr("font-size",function(){return lt.fontSize+"px"}),F.select("circle").attr("r",function(e){return e.bcnhighlight?1.5*lt.nodeSize:lt.nodeSize}).style("fill",function(e){return e.bcnhighlight?e.bcnhighlight:e.searchHighlight?"red":e[rt]&&!(e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight)?s(e[rt]):e.clickedParentHighlight||e.correspondingHighlight||e.mouseoverHighlight?"green":e._children?"orange":"black"}).style("stroke","black").style("stroke-width",1),F.select("rect").attr("width",function(e){return e.clickedHighlight?2*lt.nodeSize+"px":"0px"}).attr("height",function(e){return e.clickedHighlight?2*lt.nodeSize+"px":"0px"}).style("fill",function(e){return e.clickedHighlight?e.clickedHighlight:void 0}).attr("y",-lt.nodeSize+"px").attr("x",-lt.nodeSize+"px");var P=F.transition().duration(n).attr("transform",function(e){return"translate("+e.y+","+e.x+")"});P.select("text").style("fill-opacity",1).text(function(e){if(!e.children&&!e._children)return e.name;if("none"===lt.internalLabels)return"";if("name"===lt.internalLabels)return e.name;if("length"===lt.internalLabels){if(e.length)return e.length.toFixed(3)}else if("similarity"===lt.internalLabels&&e[rt])return e[rt].toFixed(3)});var A=F.exit().transition().duration(n).attr("transform",function(n){if(e===t.root){var r=H(n);return"translate("+r.y+","+r.x+")"}return"translate("+e.y+","+e.x+")"}).remove();A.select("circle").attr("r",1e-6).attr("stroke","none"),A.select("text").style("fill-opacity",1e-6),A.select("path").attr("d",function(){return"M0,0L0,0L0,0L0,0"}),A.select(".triangleText").attr("x",0).style("fill-opacity",1e-6).each("end",function(){d3.select(this).text("")}),F.each(function(e){if(e._children){var t=0;_.each(e.leaves,function(e){t+=f(e)*(E/W)});var r=t/e.leaves.length,i=B/tt*e.leaves.length/2;d3.select(this).select("path").transition().duration(n).attr("d",function(e){return"M0,0L"+(r-f(e)*(E/W))+","+-i+"L"+(r-f(e)*(E/W))+","+i+"L0,0"}).style("fill",function(e){return e[rt]?s(e[rt]):"black"}),d3.select(this).select(".triangleText").attr("font-size",function(){return lt.fontSize+"px"}),d3.select(this).select(".triangleText").transition().duration(n).style("fill-opacity",1).text(function(e){var t=e.leaves[0].name+" ... "+e.leaves[e.leaves.length-1].name;return t}).attr("x",function(e){var t=r-f(e)*(E/W)+5;return t})}e.children&&(d3.select(this).select("path").transition().duration(n).attr("d",function(){return"M0,0L0,0L0,0L0,0"}),d3.select(this).select(".triangleText").transition().duration(n).attr("x",0).style("fill-opacity",1e-6).each("end",function(){d3.select(this).text("")}))}),t.root[rt]&&a("bg"),a("front"),c.forEach(function(e){e.x0=e.x,e.y0=e.y}),lt.enableDownloadButtons&&setTimeout(function(){k(t.canvasId)},n),d(t.scaleText,t.zoomBehaviour.scale(),t.root)}function m(e){$("#zoomSlider"+e.id).on("input change",function(){e.zoomBehaviour.scale($("#zoomSlider"+e.id).val()),e.zoomBehaviour.event(e.svg)})}function y(e,t){t?(e.treeWidth=parseInt(e.treeWidth)+40,e.treeWidth=e.treeWidth>5?e.treeWidth:5):(e.treeWidth=parseInt(e.treeWidth)-40,e.treeWidth=e.treeWidth>5?e.treeWidth:5)}function b(e,t){t?(e.treeHeight=parseInt(e.treeHeight)+1,e.treeHeight=e.treeHeight>1?e.treeHeight:1):(e.treeHeight=parseInt(e.treeHeight)-1,e.treeHeight=e.treeHeight>1?e.treeHeight:1)}function k(e){$("#downloadButtons"+e).empty();var t=d3.select("#"+e+" svg").attr("version",1.1).attr("xmlns","http://www.w3.org/2000/svg").node().outerHTML;d3.select("#downloadButtons"+e).append("a").attr("title","file.svg").attr("href-lang","image/svg+xml").attr("href","data:image/svg+xml;base64,\n"+btoa(t)).text("Download As SVG").attr("download","PhyloIO_Tree"),$("#downloadButtons"+e+" a").css({color:"#999"})}function z(e,t){for(var n=!0,r=0;r<e.length;r++)e[r]&&t[r]&&(n=n&&e[r]===t[r]);return n}function H(e){return e.parent?e._children&&e.parent.children?e:H(e.parent):e}function w(e,t,n,r){function i(){b(H.data,!1),v(H.root,H.data,0)}function a(){b(H.data,!0),v(H.root,H.data,0)}function o(){y(H.data,!1),v(H.root,H.data,0)}function l(){y(H.data,!0),v(H.root,H.data,0)}function s(){D=!1,$("#resultsList"+t).empty(),$("#resultsBox"+t).slideUp(300,function(){$("#resultsBox"+t).css({display:"none"})}),$("#searchInput"+t).animate({width:"0px"},600,function(){$("#searchInput"+t).css({display:"none"}),$("#searchInput"+t).val("")})}function c(){var e=d3.event.scale,n=H.data.prevSemanticScale;if(n>e)b(H.data,!0),y(H.data,!0),v(H.root,H.data,0),H.data.prevSemanticScale=e,V.translate(H.data.prevTransform?H.data.prevTransform:[0,0]);else if(e>n)b(H.data,!1),y(H.data,!1),v(H.root,H.data,0),V.translate(H.data.prevTransform?H.data.prevTransform:[0,0]);else if(n==e){var r=100,i=$("#"+t+" svg").width(),a=$("#"+t+" svg").height(),o=d3.select("#"+t+" svg g").node().getBBox().height,l=d3.select("#"+t+" svg g").node().getBBox().width,s=d3.event.translate,c=-(o-a)-r*e,h=r,u=-(l-i)-r*e,g=r;d(U,e,Y),a-2*r>o&&(h=c-r,c=r),i-2*r>l&&(g=u-r,u=r),s=[Math.max(Math.min(s[0],g),u),Math.max(Math.min(s[1],h),c)],V.translate(s),H.data.prevTransform=s,d3.select("#"+t+" svg g").attr("transform","translate("+s+")")}H.data.prevSemanticScale=e}function x(){var e=100,n=$("#"+t+" svg").width(),r=$("#"+t+" svg").height(),i=d3.event.scale,a=d3.select("#"+t+" svg g").node().getBBox().height*i,o=d3.select("#"+t+" svg g").node().getBBox().width*i,l=d3.event.translate,s=-(a-r)-e*i,c=e,h=-(o-n)-e*i,u=e;d(U,i,Y),r-2*e>a&&(c=s-e,s=e),n-2*e>o&&(u=h-e,h=e),l=[Math.max(Math.min(l[0],u),h),Math.max(Math.min(l[1],c),s)],j.translate(l),j.scale(i),lt.enableZoomSliders&&$("#zoomSlider"+H.data.id).val(i),d3.select("#"+t+" svg g").attr("transform","translate("+l+") scale("+i+")"),k(t)}var H=q[Z(e)];if(void 0!==r)var w=q[Z(e)];if(G.push(H),$("#"+t).empty(),$("#"+n).empty(),n="#"+n,lt.enableZoomSliders&&($("#"+t).append('<div class="zoomSliderContainer">Zoom: <input type="range" class="zoomSlider" id="zoomSlider'+Z(e)+'" min="0.05" max="5" value="1.00" step="0.01"></input></div>'),$(".zoomSliderContainer").css({position:"absolute",color:"black","margin-left":"5px","margin-top":"5px"})),lt.enableSizeControls){var B=lt.enableZoomSliders?"50px":"10px";$("#"+t).append('<div id="zoomButtons"></div>'),$("#"+t+" #zoomButtons").append('<button type="button" id="upButton" class="btn btn-primary zoomButton"><span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span></button>'),$("#"+t+" #zoomButtons").append('<button type="button" id="leftButton" class="btn btn-primary zoomButton"><span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span></button>'),$("#"+t+" #zoomButtons").append('<button type="button" id="rightButton" class="btn btn-primary zoomButton"><span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span></button>'),$("#"+t+" #zoomButtons").append('<button type="button" id="downButton" class="btn btn-primary zoomButton"><span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span></button>'),$("#"+t+" #zoomButtons").css({width:"78px","margin-left":"10px","margin-right":"10px","margin-top":B,position:"absolute"}),$("#"+t+" .zoomButton").css({"font-size":"10px",width:"26px",height:"26px","vertical-align":"top"}),$("#"+t+" .zoomButton span").css({"vertical-align":"middle"}),$("#"+t+" #upButton").css({display:"block","margin-left":"26px"}),$("#"+t+" #leftButton").css({"float":"left"}),$("#"+t+" #rightButton").css({"margin-left":"26px","float":"right"}),$("#"+t+" #downButton").css({display:"block","margin-left":"26px"});var S=0;$("#"+t+" #upButton").mousedown(function(){i(),S=setInterval(i,50)}).bind("mouseup mouseleave",function(){clearTimeout(S)});var M=0;$("#"+t+" #downButton").mousedown(function(){a(),M=setInterval(a,50)}).bind("mouseup mouseleave",function(){clearTimeout(M)});var I=0;$("#"+t+" #leftButton").mousedown(function(){o(),I=setInterval(o,150)}).bind("mouseup mouseleave",function(){clearTimeout(I)});var W=0;$("#"+t+" #rightButton").mousedown(function(){l(),W=setInterval(l,150)}).bind("mouseup mouseleave",function(){clearTimeout(W)})}var E=0,F=$("#"+t).width(),P=$("#"+t).height(),A=d3.layout.tree().size([P,F]),N=(d3.svg.diagonal().projection(function(e){return[e.y,e.x]}),d3.select("#"+t).append("svg").attr("width",F).attr("height",P).append("g"));if(lt.enableDownloadButtons&&($("#"+t).append('<div id="downloadButtons'+t+'"></div>'),$("#downloadButtons"+t).css({"margin-left":"2px",bottom:"5px",position:"absolute"})),lt.enableSearch){$("#"+t).append('<div id="searchBox'+t+'"><a class="btn btn-default" id="searchButton'+t+'"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></a><input type="text" placeholder="search" id="searchInput'+t+'" autofocus></input></div>'),$("#searchBox"+t).append('<div id="resultsBox'+t+'"><ul id="resultsList'+t+'"></ul></div>'),$("#searchBox"+t).css({"max-width":"250px","min-height":"45px",padding:"5px",right:"5px",top:"5px",position:"absolute","background-color":"gray","-webkit-border-radius":"5px","-moz-border-radius":"5px","border-radius":"5px"}),$("#searchInput"+t).css({"float":"right",width:"0px","margin-left":"0px","margin-top":"5px",display:"none"}),$("#searchButton"+t).css({width:"50px","float":"right"}),$("#resultsBox"+t).css({width:"200px",position:"absolute","margin-right":"10px","max-height":"200px",overflow:"scroll","margin-top":"40px","background-color":"#efefef","-webkit-box-shadow":"0px 0px 2px 1px rgba(0,0,0,0.75)","-moz-box-shadow":"0px 0px 2px 1px rgba(0,0,0,0.75)","box-shadow":"0px 0px 2px 1px rgba(0,0,0,0.75)",display:"none","padding-top":"10px"});var D=!1;$("#searchButton"+t).click(function(){D?s():(D=!0,$("#searchInput"+t).css({display:"inline"}),$("#searchInput"+t).animate({width:"150px"},600,function(){$("#searchInput"+t).focus()}))});for(var O=[],E=0;E<H.root.leaves.length;E++)O.push(H.root.leaves[E]);$("#"+t+" svg").click(function(){s()}),$("#searchInput"+t).bind("paste keyup",function(){$("#resultsList"+t).empty();var e=$(this).val(),n=_.filter(O,function(t){return z(t.name.toLowerCase(),e.toLowerCase())});if(""!==e){$("#resultsBox"+t).slideDown(200),$("#resultsList"+t).empty();for(var i=0;i<n.length;i++)$("#resultsList"+t).append('<li class="'+i+'"><a href="#">'+n[i].name+"</a></li>"),$("#resultsList"+t+" li").css({"margin-left":"-25px","list-style-type":"none",cursor:"pointer",cursor:"hand"}),$("#resultsList"+t+" ."+i).on("click",function(){var e=$(this).attr("class");C(n[e]),void 0!==r?(lt.loadingCallback(),setTimeout(function(){T(H.root,w.root,!1),lt.loadedCallback(),v(H.root,H.data)},2)):v(H.root,H.data)})}else $("#resultsList"+t).empty(),$("#resultsBox"+t).slideUp(200,function(){$("#resultsBox"+t).css({display:"none"})})})}var j=d3.behavior.zoom().scaleExtent([lt.scaleMin,lt.scaleMax]).on("zoom",x),V=d3.behavior.zoom().on("zoom",c);$(".zoomSlider").attr("min",lt.scaleMin),$(".zoomSlider").attr("max",lt.scaleMax),"traditional"===lt.zoomMode?d3.select("#"+t+" svg").call(j):"semantic"===lt.zoomMode&&d3.select("#"+t+" svg").call(V);var Y=H.root;if(Y.x0=P/2,Y.y0=0,n){{d3.select(n).append("svg").attr("width",$(n).width()).attr("height",$(n).height()).append("g")}d3.select(n+" svg").append("path").attr("d",function(){var e=parseFloat(d3.select(n+" svg").style("width"));return X=.75*e,"M"+J+",20L"+(X+J)+",20"}).attr("stroke-width",1).attr("stroke",lt.scaleColor);var U=d3.select(n+" svg").append("text").attr("x",X/2+J).attr("y",35).attr("font-family","sans-serif").text("0").attr("font-size","14px").attr("fill",lt.scaleColor).attr("text-anchor","middle");jQuery.extend(H.data,{scaleText:U})}if(jQuery.extend(H.data,{canvasId:t,root:Y,tree:A,svg:N,i:E,id:Z(e),zoomBehaviour:j,zoomBehaviourSemantic:V,scaleId:n}),p(H.data.root,function(e){e.leaves=h(e),e.clickedParentHighlight=!1,e.correspondingHighlight=!1,e.mouseoverHighlight=!1}),m(H.data),jQuery.extend(H.data,{treeWidth:lt.treeWidth,treeHeight:lt.treeHeight}),"scale"===lt.fitTree){var K=P-2*et,R=L(H.root),nt=0,rt=0;p(H.root,function(e){e._children&&(nt+=e.leaves.length,rt+=1)},!1);var it=1;R>0?it=K/(R+nt):(it=K/(R+nt),it*=tt,it-=it/tt/2,H.data.prevNoLeavesVisible=!0);var at=0;u(H.data.root),p(H.data.root,function(e){var t=f(e);t>at&&(at=t)});var ot=g(H.data.root),st=F/at*ot-2*et;H.data.treeWidth=st,H.data.treeHeight=it}v(H.root,H.data),Q(),d3.select("#"+t).on("mousemove",function(){if(lt.enableFisheyeZoom){var e=N.selectAll("path.link"),t=N.selectAll("path.linkbg"),n=N.selectAll("g.node"),r=j.scale(),i=d3.fisheye.circular().radius(600/(3*r)).distortion(2/(r/.9)),a=[(d3.mouse(this)[1]-j.translate()[1])/r,(d3.mouse(this)[0]-j.translate()[0])/r];i.focus(a),n.each(function(e){e.fisheye=i(e)}),n.select("circle").attr("r",function(e){return e.fisheye.z*lt.nodeSize}).attr("cy",function(e){return e.fisheye.x-e.x}),n.select("path").attr("d",function(e){if(e._children){var t=g(H.root),n=H.data.treeWidth,r=0,i=H.data.treeHeight;_.each(e.leaves,function(e){r+=f(e)*(n/t)});var a=r/e.leaves.length,o=i/tt*e.leaves.length/2;return"M0,"+(e.fisheye.x-e.x)+"L"+(a-f(e)*(n/t))+","+(-o-e.x+e.fisheye.x)+"L"+(a-f(e)*(n/t))+","+(o-e.x+e.fisheye.x)+"L0,"+(e.fisheye.x-e.x)}}),n.select(".triangleText").attr("y",function(e){return e.fisheye.x-e.x}).attr("font-size",function(e){if(d3.select(this).attr("font-size")){var t=e.fisheye.z/2>1?e.fisheye.z/2:1;return lt.fontSize*t}}),n.select("rect").attr("width",function(e){return e.clickedHighlight?e.fisheye.z*lt.nodeSize*2:void 0}).attr("height",function(e){return e.clickedHighlight?e.fisheye.z*lt.nodeSize*2:void 0}).attr("y",function(e){return e.fisheye.x-e.x-e.fisheye.z*lt.nodeSize}),n.select("text").attr("font-size",function(e){if(d3.select(this).attr("font-size")){var t=e.fisheye.z/2>1?e.fisheye.z/2:1;return lt.fontSize*t}}).attr("y",function(e){return e.fisheye.x-e.x}),e.attr("d",function(e){return"M"+e.source.y+","+e.source.fisheye.x+"L"+e.source.y+","+e.target.fisheye.x+"L"+e.target.y+","+e.target.fisheye.x}),t.attr("d",function(e){return"M"+e.source.y+","+e.source.fisheye.x+"L"+e.source.y+","+e.target.fisheye.x+"L"+e.target.y+","+e.target.fisheye.x})}}),d3.select(self.frameElement).style("height","500px")}function L(e){var t=0;return p(e,function(e){var n=c(e);0===n.length&&(t+=1)},!1),t}function B(e){lt.autoCollapse=e;for(var t=0;t<G.length;t++)null===e?D(G[t].root):N(G[t].root,e);2===G.length?(lt.loadingCallback(),setTimeout(function(){T(G[0].root,G[1].root,!1),v(G[0].root,G[0].data),v(G[1].root,G[1].data),lt.loadedCallback()},2)):v(G[0].root,G[0].data)}function C(e,t){void 0===t&&(t=!1),e.parent&&(t?e.searchHighlight=!1:(e.parent._children&&(e.parent.children=e.parent._children,e.parent._children=null),e.searchHighlight=!0),C(e.parent,t))}function S(e){e.parent&&(e.parent._children&&(e.parent.children=e.parent._children,e.parent._children=null),S(e.parent))}function T(e,t,n){function r(e,t){var i=e.children?e.children:[];if(i.length>0){for(var a=0;a<i.length;a++)r(i[a],t);return void((n||!e.elementBCN)&&U(e,t))}return void((n||!e.elementBCN)&&U(e,t))}void 0===n&&(n=!0),r(e,t),r(t,e)}function M(e,t){for(var n=q[e].root,r=q[t].root,i=0;i<n.leaves.length;i++)for(var a=0;a<r.leaves.length;a++)n.leaves[i].name===r.leaves[a].name&&(n.leaves[i].correspondingLeaf=r.leaves[a],r.leaves[a].correspondingLeaf=n.leaves[i]);p(n,function(e){e.deepLeafList=E(e)}),p(r,function(e){e.deepLeafList=E(e)}),T(n,r)}function I(e,t){for(var n=[],r=0;r<e.leaves.length;r++)for(var i=0;i<t.length;i++)if(e.leaves[r].name===t[i].name){n.push(e);for(var a=c(e),o=0;o<a.length;o++)n=n.concat(I(a[o],t));return n}return n}function W(e){return e.name}function E(e){function t(e){var i=c(e);{if(!(i.length>0))return void n.push(e.name);r>0&&n.push(_.sortBy(_.map(e.leaves,W),function(e){return e}).toString()),r+=1;for(var a=0;a<i.length;a++)t(i[a])}}var n=[],r=0;return t(e),n}function F(e,t){var n=e.deepLeafList,r=t.deepLeafList,i=n.length,a=r.length,o=_.intersection(n,r).length;return o/(i+a-o)}function Z(e){for(var t=0;t<q.length;t++)if(e===q[t].name)return t}function P(e,t,n,r,i,a){G=[];var o=Z(e),l=Z(n);lt.loadingCallback(),setTimeout(function(){D(q[o].root),D(q[l].root),O(q[o].root),O(q[l].root),j(q[o].root),j(q[l].root),null!==lt.autoCollapse&&(N(q[o].root,lt.autoCollapse),N(q[l].root,lt.autoCollapse)),M(o,l),q[o].data.clickEvent=Y(q[o],!0,q[l]),q[l].data.clickEvent=Y(q[l],!0,q[o]),w(e,t,i,n),w(n,r,a,e),lt.loadedCallback()},2)}function A(e,t,n){G=[];var r=Z(e);lt.loadingCallback(),setTimeout(function(){D(q[r].root),O(q[r].root),j(q[r].root),null!==lt.autoCollapse&&N(q[r].root,lt.autoCollapse),q[r].data.clickEvent=Y(q[r],!1,{}),w(e,t,n),lt.loadedCallback()},2)}function N(e,t){e.depth>t?e.children&&(e._children=e.children,e.children=null):e._children&&(e.children=e._children,e._children=null);for(var n=c(e),r=0;r<n.length;r++)N(n[r],t)}function D(e){p(e,function(e){e._children&&(e.children=e._children,e._children=null)})}function O(e){p(e,function(e){e.bcnhighlight=null,e.elementBCN=null,e.elementS=null,e.x=null,e.y=null,e.x0=null,e.y0=null,e.source=null,e.target=null,e.baseX=null,e.baseY=null,e.id=null})}function j(e,t){void 0===t&&(t=0),e.depth=t;var n=c(e);t+=1;for(var r=0;r<n.length;r++)j(n[r],t)}function Q(){return function(){function e(t,n,r){function i(e){var i=t(e),a=r>i,o=d3.extent(t.range()),l=o[0],s=o[1],c=a?r-l:s-r;return 0==c&&(c=s-l),(a?-1:1)*c*(n+1)/(n+c/Math.abs(i-r))+r}return i.distortion=function(e){return arguments.length?(n=+e,i):n},i.focus=function(e){return arguments.length?(r=+e,i):r},i.copy=function(){return e(t.copy(),n,r)},i.nice=t.nice,i.ticks=t.ticks,i.tickFormat=t.tickFormat,d3.rebind(i,t,"domain","range")}d3.fisheye={scale:function(t){return e(t(),3,0)},circular:function(){function e(e){var t=e.x-o[0],a=e.y-o[1],l=Math.sqrt(t*t+a*a);if(!l||l>=i)return{x:e.x,y:e.y,z:l>=i?1:10};var s=n*(1-Math.exp(-l*r))/l*.75+.25;return{x:o[0]+t*s,y:o[1]+a*s,z:Math.min(s,10)}}function t(){return n=Math.exp(a),n=n/(n-1)*i,r=a/i,e}var n,r,i=200,a=2,o=[0,0];return e.radius=function(e){return arguments.length?(i=+e,t()):i},e.distortion=function(e){return arguments.length?(a=+e,t()):a},e.focus=function(t){return arguments.length?(o=t,e):o},t()}}}()}function V(e){e.selectAll(".tooltipElem").remove()}function Y(e,t,n){function r(r){function i(r){var i=!1;t&&r._children&&(i=!0,lt.loadingCallback()),setTimeout(function(){r.children?(r._children=r.children,r.children=null):(r.children=r._children,r._children=null,t&&p(r,function(e){U(e,n.root)},!1)),i&&lt.loadedCallback(),v(r,e.data)},2)}function a(r){var i=!1;t&&r._children&&(i=!0,lt.loadingCallback()),setTimeout(function(){r._children?p(r,function(e){e._children&&(e.children=e._children,e._children=null),t&&U(e,n.root)}):r.children&&p(r,function(e){e.children&&(e._children=e.children,e.children=null)}),i&&lt.loadedCallback(),v(r,e.data)},2)}function o(r){function i(e,t){if(e.children)for(var n=0;n<e.children.length;n++)i(e.children[n],t);e.clickedParentHighlight=t?!0:!1}var a=d3.scale.category20();if(t)if(_.contains(at,r)){r.clickedHighlight=!1;var o=at.indexOf(r);o>-1&&at.splice(o,1),r[it].bcnhighlight=!1;for(var l=(r[it]?r[it].id:-1,r.leaves),s=n.root,c=n.data,d=(c.leaves,0);d<l.length;d++)l[d].correspondingLeaf.correspondingHighlight=!1;i(r,!1),v(r,e.data),v(c.root,c)}else if(at.length<ot){r.clickedHighlight=a(at.length),r[it].bcnhighlight=a(at.length),at.push(r);for(var l=r.leaves,s=n.root,c=n.data,d=(c.leaves,0);d<l.length;d++)l[d].correspondingLeaf.correspondingHighlight=!0;S(r[it]),lt.loadingCallback(),setTimeout(function(){if(T(s,e.root,!1),lt.loadedCallback(),i(r,!0),v(r,e.data),v(c.root,c),lt.moveOnClick){var t=c.zoomBehaviour.scale(),n=-r[it].y+$("#"+c.canvasId).width()/2/t,a=-r[it].x+$("#"+c.canvasId).height()/2/t;c.zoomBehaviour.translate([n,a]),d3.select("#"+c.canvasId+" svg g").transition(1500).attr("transform","scale("+t+")translate("+c.zoomBehaviour.translate()+")")}},2)}}var l=e.data.svg;if(r.tooltipActive)return r.tooltipActive=!1,p(r,function(e){e.mouseoverHighlight=!1}),v(r,e.data),void V(l);r.tooltipActive=!0,r.children||r._children||r.searchHighlight!==!0||(C(r,!0),v(e.root,e.data));var s=10,c=15,d=150,h=90;d3.select(this).append("path").attr("class","tooltipElem").attr("d",function(){return"M0,0L"+-s+","+-c+"L"+s+","+-c}).style("fill","gray"),d3.select(this).append("rect").attr("class","tooltipElem").attr("x",function(){return-(d/2)}).attr("y",function(){return-c-h+1}).attr("width",d).attr("height",h).attr("rx",10).attr("ry",10).style("fill","gray");var u=10,g=20,f=0,m=20;d3.select(this).append("text").attr("class","tooltipElem tooltipElemText").attr("y",-h-c+g+f).attr("x",-d/2+u).style("fill","white").style("font-weight","bold").text(function(e){return e._children?(f+=m,"uncollapse >"):e.children?(f+=m,"collapse >"):void 0}).on("click",function(e){p(e,function(e){e.mouseoverHighlight=!1}),i(e),V(l)}),d3.select(this).append("text").attr("class","tooltipElem tooltipElemText").attr("y",-h-c+g+f).attr("x",-d/2+u).style("fill","white").style("font-weight","bold").text(function(e){return e._children?(f+=m,"uncollapse all >"):e.children?(f+=m,"collapse all >"):void 0}).on("click",function(e){p(e,function(e){e.mouseoverHighlight=!1}),a(e),V(l)}),d3.select(this).append("text").attr("class","tooltipElem tooltipElemText").attr("y",-h-c+g+f).attr("x",-d/2+u).style("fill","white").style("font-weight","bold").text(function(e){return e.elementBCN?(f+=m,e.clickedParentHighlight?"unhighlight >":"highlight >"):void 0}).on("click",function(e){p(e,function(e){e.mouseoverHighlight=!1}),o(e),V(l)}),d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},d3.select(this).moveToFront(),d3.select(this).selectAll(".tooltipElemText").each(function(){d3.select(this).on("mouseover",function(){d3.select(this).transition().duration(50).style("fill","black")}),d3.select(this).on("mouseout",function(){d3.select(this).transition().duration(50).style("fill","white")})})}return r}function U(e,t){for(var n=null,r=0,i=e.leaves,a=I(t,i),o=0;o<a.length;o++)x=F(e,a[o]),x>r&&(r=x,n=a[o]);e.elementBCN=n,e.elementS=r}var q=[],G=[],X=0,J=10,K=["rgb(254,240,217)","rgb(253,212,158)","rgb(253,187,132)","rgb(252,141,89)","rgb(227,74,51)","rgb(179,0,0)"],R=[1,.8,.6,.4,.2,0],et=20,tt=3,nt="black",rt="elementS",it="elementBCN",at=[],ot=20,lt={useLengths:!0,fontSize:14,lineThickness:3,nodeSize:3,treeWidth:500,treeHeight:15,moveOnClick:!0,enableZoomSliders:!0,scaleMin:.05,scaleMax:5,scaleColor:"black",loadingCallback:function(){},loadedCallback:function(){},internalLabels:"none",enableDownloadButtons:!0,enableFisheyeZoom:!1,zoomMode:"traditional",fitTree:"scale",enableSizeControls:!0,enableSearch:!0,autoCollapse:null};return window.onresize=t,{init:e,viewTree:A,renderColorScale:s,addTree:a,removeTree:l,getTrees:o,compareTrees:P,changeSettings:n,changeAutoCollapseDepth:B}}();